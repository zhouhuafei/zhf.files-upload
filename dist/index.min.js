"use strict";var extend=require("zhf.extend"),getDomArray=require("zhf.get-dom-array");function FilesUpload(e){this.opts=extend({input:null,limitNum:5,limitSize:2097152,overLimitCallback:function(){console.log("no find overLimitCallback")},changeCallback:function(){console.log("no find changeCallback")},base64CallbackItem:function(){console.log("no find base64CallbackItem")},base64CallbackAll:function(){console.log("no find base64CallbackAll")}},e),this.opts.input?this.init():console.log("no find input")}FilesUpload.prototype.init=function(){this.render(),this.power()},FilesUpload.prototype.render=function(){},FilesUpload.prototype.power=function(){this.events()},FilesUpload.prototype.events=function(){this.eventsInputChange()},FilesUpload.prototype.eventsInputChange=function(){var e=this,i=this.opts,t=i.limitNum,n=i.limitSize;getDomArray(i.input)[0].addEventListener("change",function(){for(var l=0,o=[],a=this.files,s=a.length,r=[],c=0;c<s;c++){l++;var u=a[c],p=u.size,d=l>t,f=p>n;d||f?r.push({isOverLimitNum:d,isOverLimitSize:f,limitNum:t,filesNum:l,size:p,limitSize:n,file:u,index:c}):o.push(u)}i.changeCallback(o),i.overLimitCallback(r),e.fileReadAsDataURL(o)})},FilesUpload.prototype.fileReadAsDataURL=function(e){var i=this.opts,t=0,n=[];e.forEach(function(l,o){var a=new FileReader;a.readAsDataURL(l),a.addEventListener("load",function(){t++,i.base64CallbackItem({base64:this.result,index:o}),n.push({base64:this.result,index:o}),t===e.length&&(n.sort(function(e,i){return e.index-i.index}),i.base64CallbackAll(n))})})},module.exports=FilesUpload;